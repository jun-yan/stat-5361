<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 Bootstrap | STAT 5361: Statistical Computing, Fall 2019</title>
  <meta name="description" content="This is a series of notes for the students of STAT 5361, Statisticl Computing, at UConn." />
  <meta name="generator" content="bookdown 0.21.5 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 Bootstrap | STAT 5361: Statistical Computing, Fall 2019" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a series of notes for the students of STAT 5361, Statisticl Computing, at UConn." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 Bootstrap | STAT 5361: Statistical Computing, Fall 2019" />
  
  <meta name="twitter:description" content="This is a series of notes for the students of STAT 5361, Statisticl Computing, at UConn." />
  

<meta name="author" content="Jun Yan" />


<meta name="date" content="2020-12-04" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="mcinteg.html"/>
<link rel="next" href="git-setup.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Prerequisites</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#a-teaser-example-likelihood-estimation"><i class="fa fa-check"></i><b>1.1</b> A Teaser Example: Likelihood Estimation</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#computer-arithmetics"><i class="fa fa-check"></i><b>1.2</b> Computer Arithmetics</a><ul>
<li class="chapter" data-level="1.2.1" data-path="index.html"><a href="index.html#integers"><i class="fa fa-check"></i><b>1.2.1</b> Integers</a></li>
<li class="chapter" data-level="1.2.2" data-path="index.html"><a href="index.html#floating-point"><i class="fa fa-check"></i><b>1.2.2</b> Floating Point</a></li>
<li class="chapter" data-level="1.2.3" data-path="index.html"><a href="index.html#error-analysis"><i class="fa fa-check"></i><b>1.2.3</b> Error Analysis</a></li>
<li class="chapter" data-level="1.2.4" data-path="index.html"><a href="index.html#condition-number"><i class="fa fa-check"></i><b>1.2.4</b> Condition Number</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#exercises"><i class="fa fa-check"></i><b>1.3</b> Exercises</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#course-project"><i class="fa fa-check"></i><b>1.4</b> Course Project</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="nla.html"><a href="nla.html"><i class="fa fa-check"></i><b>2</b> Numerical Linear Algebra</a></li>
<li class="chapter" data-level="3" data-path="optim.html"><a href="optim.html"><i class="fa fa-check"></i><b>3</b> Optimization</a><ul>
<li class="chapter" data-level="3.1" data-path="optim.html"><a href="optim.html#univariate-optimizations"><i class="fa fa-check"></i><b>3.1</b> Univariate Optimizations</a><ul>
<li class="chapter" data-level="3.1.1" data-path="optim.html"><a href="optim.html#bisection-method"><i class="fa fa-check"></i><b>3.1.1</b> Bisection Method</a></li>
<li class="chapter" data-level="3.1.2" data-path="optim.html"><a href="optim.html#newtons-method"><i class="fa fa-check"></i><b>3.1.2</b> Newton’s Method</a></li>
<li class="chapter" data-level="3.1.3" data-path="optim.html"><a href="optim.html#fixed-point-iteration"><i class="fa fa-check"></i><b>3.1.3</b> Fixed Point Iteration</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="optim.html"><a href="optim.html#multivariate-optimization"><i class="fa fa-check"></i><b>3.2</b> Multivariate Optimization</a><ul>
<li class="chapter" data-level="3.2.1" data-path="optim.html"><a href="optim.html#newton-raphson-method"><i class="fa fa-check"></i><b>3.2.1</b> Newton-Raphson Method</a></li>
<li class="chapter" data-level="3.2.2" data-path="optim.html"><a href="optim.html#variants-of-newton-raphson-method"><i class="fa fa-check"></i><b>3.2.2</b> Variants of Newton-Raphson Method</a></li>
<li class="chapter" data-level="3.2.3" data-path="optim.html"><a href="optim.html#nelder-mead-simplex-algorithm"><i class="fa fa-check"></i><b>3.2.3</b> Nelder-Mead (Simplex) Algorithm</a></li>
<li class="chapter" data-level="3.2.4" data-path="optim.html"><a href="optim.html#optimization-with-r"><i class="fa fa-check"></i><b>3.2.4</b> Optimization with R</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="optim.html"><a href="optim.html#mm-algorithm"><i class="fa fa-check"></i><b>3.3</b> MM Algorithm</a></li>
<li class="chapter" data-level="3.4" data-path="optim.html"><a href="optim.html#an-example-lasso-with-coordinate-descent"><i class="fa fa-check"></i><b>3.4</b> An Example: LASSO with Coordinate Descent</a></li>
<li class="chapter" data-level="3.5" data-path="optim.html"><a href="optim.html#exercises-1"><i class="fa fa-check"></i><b>3.5</b> Exercises</a><ul>
<li class="chapter" data-level="3.5.1" data-path="optim.html"><a href="optim.html#cauchy-with-unknown-location."><i class="fa fa-check"></i><b>3.5.1</b> Cauchy with unknown location.</a></li>
<li class="chapter" data-level="3.5.2" data-path="optim.html"><a href="optim.html#many-local-maxima"><i class="fa fa-check"></i><b>3.5.2</b> Many local maxima</a></li>
<li class="chapter" data-level="3.5.3" data-path="optim.html"><a href="optim.html#modeling-beetle-data"><i class="fa fa-check"></i><b>3.5.3</b> Modeling beetle data</a></li>
<li class="chapter" data-level="3.5.4" data-path="optim.html"><a href="optim.html#coordinate-descent-for-penalized-least-squares"><i class="fa fa-check"></i><b>3.5.4</b> Coordinate descent for penalized least squares</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="em-algorithm.html"><a href="em-algorithm.html"><i class="fa fa-check"></i><b>4</b> EM Algorithm</a><ul>
<li class="chapter" data-level="4.1" data-path="em-algorithm.html"><a href="em-algorithm.html#introduction"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="em-algorithm.html"><a href="em-algorithm.html#em-algorithm-1"><i class="fa fa-check"></i><b>4.2</b> EM Algorithm</a></li>
<li class="chapter" data-level="4.3" data-path="em-algorithm.html"><a href="em-algorithm.html#example-clustering-by-em"><i class="fa fa-check"></i><b>4.3</b> Example: Clustering by EM</a></li>
<li class="chapter" data-level="4.4" data-path="em-algorithm.html"><a href="em-algorithm.html#variants-of-em"><i class="fa fa-check"></i><b>4.4</b> Variants of EM</a><ul>
<li class="chapter" data-level="4.4.1" data-path="em-algorithm.html"><a href="em-algorithm.html#mcem"><i class="fa fa-check"></i><b>4.4.1</b> MCEM</a></li>
<li class="chapter" data-level="4.4.2" data-path="em-algorithm.html"><a href="em-algorithm.html#ecm"><i class="fa fa-check"></i><b>4.4.2</b> ECM</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="em-algorithm.html"><a href="em-algorithm.html#standard-errors"><i class="fa fa-check"></i><b>4.5</b> Standard Errors</a><ul>
<li class="chapter" data-level="4.5.1" data-path="em-algorithm.html"><a href="em-algorithm.html#supplemental-em-sem"><i class="fa fa-check"></i><b>4.5.1</b> Supplemental EM (SEM)</a></li>
<li class="chapter" data-level="4.5.2" data-path="em-algorithm.html"><a href="em-algorithm.html#direct-calculation-of-the-information-matrix"><i class="fa fa-check"></i><b>4.5.2</b> Direct Calculation of the Information Matrix</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="em-algorithm.html"><a href="em-algorithm.html#acceleration"><i class="fa fa-check"></i><b>4.6</b> Acceleration</a></li>
<li class="chapter" data-level="4.7" data-path="em-algorithm.html"><a href="em-algorithm.html#example-hidden-markov-model"><i class="fa fa-check"></i><b>4.7</b> Example: Hidden Markov Model</a></li>
<li class="chapter" data-level="4.8" data-path="em-algorithm.html"><a href="em-algorithm.html#exercises-2"><i class="fa fa-check"></i><b>4.8</b> Exercises</a><ul>
<li class="chapter" data-level="4.8.1" data-path="em-algorithm.html"><a href="em-algorithm.html#finite-mixture-regression"><i class="fa fa-check"></i><b>4.8.1</b> Finite mixture regression</a></li>
<li class="chapter" data-level="4.8.2" data-path="em-algorithm.html"><a href="em-algorithm.html#acceleration-of-em-algorithm"><i class="fa fa-check"></i><b>4.8.2</b> Acceleration of EM algorithm</a></li>
<li class="chapter" data-level="4.8.3" data-path="em-algorithm.html"><a href="em-algorithm.html#a-poisson-hmm-for-earthquake-data"><i class="fa fa-check"></i><b>4.8.3</b> A Poisson-HMM for earthquake data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="random-number-generation.html"><a href="random-number-generation.html"><i class="fa fa-check"></i><b>5</b> Random Number Generation</a><ul>
<li class="chapter" data-level="5.1" data-path="random-number-generation.html"><a href="random-number-generation.html#univariate-random-number-generation"><i class="fa fa-check"></i><b>5.1</b> Univariate Random Number Generation</a><ul>
<li class="chapter" data-level="5.1.1" data-path="random-number-generation.html"><a href="random-number-generation.html#inverse-cdf"><i class="fa fa-check"></i><b>5.1.1</b> Inverse CDF</a></li>
<li class="chapter" data-level="5.1.2" data-path="random-number-generation.html"><a href="random-number-generation.html#rejection-method"><i class="fa fa-check"></i><b>5.1.2</b> Rejection Method</a></li>
<li class="chapter" data-level="5.1.3" data-path="random-number-generation.html"><a href="random-number-generation.html#sampling-importance-resampling"><i class="fa fa-check"></i><b>5.1.3</b> Sampling Importance Resampling</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="random-number-generation.html"><a href="random-number-generation.html#stochastic-processes"><i class="fa fa-check"></i><b>5.2</b> Stochastic Processes</a><ul>
<li class="chapter" data-level="5.2.1" data-path="random-number-generation.html"><a href="random-number-generation.html#gaussian-markov-process"><i class="fa fa-check"></i><b>5.2.1</b> Gaussian Markov Process</a></li>
<li class="chapter" data-level="5.2.2" data-path="random-number-generation.html"><a href="random-number-generation.html#counting-process"><i class="fa fa-check"></i><b>5.2.2</b> Counting Process</a></li>
<li class="chapter" data-level="5.2.3" data-path="random-number-generation.html"><a href="random-number-generation.html#inhomogeneous-poisson-process"><i class="fa fa-check"></i><b>5.2.3</b> Inhomogeneous Poisson Process</a></li>
<li class="chapter" data-level="5.2.4" data-path="random-number-generation.html"><a href="random-number-generation.html#jump-diffusion-process"><i class="fa fa-check"></i><b>5.2.4</b> Jump-Diffusion Process</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="random-number-generation.html"><a href="random-number-generation.html#exercises-3"><i class="fa fa-check"></i><b>5.3</b> Exercises</a><ul>
<li class="chapter" data-level="5.3.1" data-path="random-number-generation.html"><a href="random-number-generation.html#rejection-sampling"><i class="fa fa-check"></i><b>5.3.1</b> Rejection sampling</a></li>
<li class="chapter" data-level="5.3.2" data-path="random-number-generation.html"><a href="random-number-generation.html#mixture-proposal"><i class="fa fa-check"></i><b>5.3.2</b> Mixture Proposal</a></li>
<li class="chapter" data-level="5.3.3" data-path="random-number-generation.html"><a href="random-number-generation.html#orsteinuhlenbeck-process"><i class="fa fa-check"></i><b>5.3.3</b> Orstein–Uhlenbeck Process</a></li>
<li class="chapter" data-level="5.3.4" data-path="random-number-generation.html"><a href="random-number-generation.html#poisson-process"><i class="fa fa-check"></i><b>5.3.4</b> Poisson Process</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html"><i class="fa fa-check"></i><b>6</b> Markov Chain Monte Carlo</a><ul>
<li class="chapter" data-level="6.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#eample-normal-mixture"><i class="fa fa-check"></i><b>6.1</b> Eample: Normal mixture</a></li>
<li class="chapter" data-level="6.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#general-purpose-gibbs-sampling-with-the-arms"><i class="fa fa-check"></i><b>6.2</b> General-Purpose Gibbs Sampling with the ARMS</a></li>
<li class="chapter" data-level="6.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#exercises-4"><i class="fa fa-check"></i><b>6.3</b> Exercises</a><ul>
<li class="chapter" data-level="6.3.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#normal-mixture-revisited"><i class="fa fa-check"></i><b>6.3.1</b> Normal mixture revisited</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="mcinteg.html"><a href="mcinteg.html"><i class="fa fa-check"></i><b>7</b> Monte Carlo Integration</a><ul>
<li class="chapter" data-level="7.1" data-path="mcinteg.html"><a href="mcinteg.html#introduction-1"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="mcinteg.html"><a href="mcinteg.html#option-pricing"><i class="fa fa-check"></i><b>7.2</b> Option Pricing</a></li>
<li class="chapter" data-level="7.3" data-path="mcinteg.html"><a href="mcinteg.html#particle-filtering-for-state-space-models"><i class="fa fa-check"></i><b>7.3</b> Particle Filtering for State Space Models</a></li>
<li class="chapter" data-level="7.4" data-path="mcinteg.html"><a href="mcinteg.html#variance-reduction"><i class="fa fa-check"></i><b>7.4</b> Variance Reduction</a><ul>
<li class="chapter" data-level="7.4.1" data-path="mcinteg.html"><a href="mcinteg.html#importance-sampling"><i class="fa fa-check"></i><b>7.4.1</b> Importance Sampling</a></li>
<li class="chapter" data-level="7.4.2" data-path="mcinteg.html"><a href="mcinteg.html#control-variates"><i class="fa fa-check"></i><b>7.4.2</b> Control Variates</a></li>
<li class="chapter" data-level="7.4.3" data-path="mcinteg.html"><a href="mcinteg.html#antithetic-variates"><i class="fa fa-check"></i><b>7.4.3</b> Antithetic Variates</a></li>
<li class="chapter" data-level="7.4.4" data-path="mcinteg.html"><a href="mcinteg.html#stratified-sampling"><i class="fa fa-check"></i><b>7.4.4</b> Stratified Sampling</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="mcinteg.html"><a href="mcinteg.html#exercises-5"><i class="fa fa-check"></i><b>7.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="boot.html"><a href="boot.html"><i class="fa fa-check"></i><b>8</b> Bootstrap</a><ul>
<li class="chapter" data-level="8.1" data-path="boot.html"><a href="boot.html#principles-of-bootstrap"><i class="fa fa-check"></i><b>8.1</b> Principles of Bootstrap</a></li>
<li class="chapter" data-level="8.2" data-path="boot.html"><a href="boot.html#parametric-bootstrap"><i class="fa fa-check"></i><b>8.2</b> Parametric Bootstrap</a><ul>
<li class="chapter" data-level="8.2.1" data-path="boot.html"><a href="boot.html#goodness-of-fit-test"><i class="fa fa-check"></i><b>8.2.1</b> Goodness-of-Fit Test</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="boot.html"><a href="boot.html#block-bootstrap"><i class="fa fa-check"></i><b>8.3</b> Block bootstrap</a></li>
<li class="chapter" data-level="8.4" data-path="boot.html"><a href="boot.html#semiparametric-bootstrap"><i class="fa fa-check"></i><b>8.4</b> Semiparametric bootstrap</a></li>
<li class="chapter" data-level="8.5" data-path="boot.html"><a href="boot.html#multiplier-bootstrap"><i class="fa fa-check"></i><b>8.5</b> Multiplier bootstrap</a><ul>
<li class="chapter" data-level="8.5.1" data-path="boot.html"><a href="boot.html#multiplier-central-limit-theorem"><i class="fa fa-check"></i><b>8.5.1</b> Multiplier central limit theorem</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="boot.html"><a href="boot.html#exercises-6"><i class="fa fa-check"></i><b>8.6</b> Exercises</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="git-setup.html"><a href="git-setup.html"><i class="fa fa-check"></i><b>A</b> Git Setup</a><ul>
<li class="chapter" data-level="A.1" data-path="git-setup.html"><a href="git-setup.html#git-windows"><i class="fa fa-check"></i><b>A.1</b> Git for Windows installer</a></li>
</ul></li>
<li class="chapter" data-level="B" data-path="git-lesson.html"><a href="git-lesson.html"><i class="fa fa-check"></i><b>B</b> Git Lesson</a><ul>
<li class="chapter" data-level="B.1" data-path="git-lesson.html"><a href="git-lesson.html#automated-version-control"><i class="fa fa-check"></i><b>B.1</b> Automated Version Control</a></li>
<li class="chapter" data-level="B.2" data-path="git-lesson.html"><a href="git-lesson.html#setup"><i class="fa fa-check"></i><b>B.2</b> Setup</a></li>
<li class="chapter" data-level="B.3" data-path="git-lesson.html"><a href="git-lesson.html#creating-a-repository"><i class="fa fa-check"></i><b>B.3</b> Creating a Repository</a></li>
<li class="chapter" data-level="B.4" data-path="git-lesson.html"><a href="git-lesson.html#setting-up-git-authorship"><i class="fa fa-check"></i><b>B.4</b> Setting up Git Authorship</a></li>
<li class="chapter" data-level="B.5" data-path="git-lesson.html"><a href="git-lesson.html#tracking-changes"><i class="fa fa-check"></i><b>B.5</b> Tracking Changes</a></li>
<li class="chapter" data-level="B.6" data-path="git-lesson.html"><a href="git-lesson.html#undo-changes"><i class="fa fa-check"></i><b>B.6</b> Undo Changes</a></li>
<li class="chapter" data-level="B.7" data-path="git-lesson.html"><a href="git-lesson.html#explore-history"><i class="fa fa-check"></i><b>B.7</b> Explore History</a></li>
<li class="chapter" data-level="B.8" data-path="git-lesson.html"><a href="git-lesson.html#next-steps"><i class="fa fa-check"></i><b>B.8</b> Next Steps</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">STAT 5361: Statistical Computing, Fall 2019</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="boot" class="section level1">
<h1><span class="header-section-number">Chapter 8</span> Bootstrap</h1>
<div id="principles-of-bootstrap" class="section level2">
<h2><span class="header-section-number">8.1</span> Principles of Bootstrap</h2>
<p>Example from Efron’s original 1979 paper.</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb168-1" data-line-number="1">median.boot &lt;-<span class="st"> </span><span class="cf">function</span>(x, nboot) {</a>
<a class="sourceLine" id="cb168-2" data-line-number="2">  tx &lt;-<span class="st"> </span><span class="kw">median</span>(x)</a>
<a class="sourceLine" id="cb168-3" data-line-number="3">  sx &lt;-<span class="st"> </span><span class="kw">sd</span>(x)</a>
<a class="sourceLine" id="cb168-4" data-line-number="4">  n &lt;-<span class="st"> </span><span class="kw">length</span>(x)</a>
<a class="sourceLine" id="cb168-5" data-line-number="5">  do1rep &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb168-6" data-line-number="6">    x.b &lt;-<span class="st"> </span><span class="kw">sample</span>(x, <span class="kw">length</span>(x), <span class="dt">replace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb168-7" data-line-number="7">    <span class="kw">abs</span>(<span class="kw">median</span>(x.b) <span class="op">-</span><span class="st"> </span>tx) <span class="op">/</span><span class="st"> </span>sx</a>
<a class="sourceLine" id="cb168-8" data-line-number="8">  }</a>
<a class="sourceLine" id="cb168-9" data-line-number="9">  r.sample &lt;-<span class="st"> </span><span class="kw">replicate</span>(nboot, <span class="kw">do1rep</span>(x))</a>
<a class="sourceLine" id="cb168-10" data-line-number="10">  <span class="kw">c</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(r.sample) <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(n), <span class="dt">sd =</span> <span class="kw">sd</span>(r.sample))</a>
<a class="sourceLine" id="cb168-11" data-line-number="11">}</a>
<a class="sourceLine" id="cb168-12" data-line-number="12"></a>
<a class="sourceLine" id="cb168-13" data-line-number="13">x &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">13</span>)</a>
<a class="sourceLine" id="cb168-14" data-line-number="14"></a>
<a class="sourceLine" id="cb168-15" data-line-number="15"><span class="kw">median.boot</span>(x, <span class="dv">50</span>)</a></code></pre></div>
<pre><code>##      mean        sd 
## 0.8155341 0.2507561</code></pre>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb170-1" data-line-number="1">sim &lt;-<span class="st"> </span><span class="kw">replicate</span>(<span class="dv">200</span>, <span class="kw">median.boot</span>(<span class="kw">rnorm</span>(<span class="dv">13</span>), <span class="dv">100</span>))</a>
<a class="sourceLine" id="cb170-2" data-line-number="2"><span class="kw">summary</span>(<span class="kw">t</span>(sim))</a></code></pre></div>
<pre><code>##       mean              sd        
##  Min.   :0.3411   Min.   :0.1109  
##  1st Qu.:0.7191   1st Qu.:0.2171  
##  Median :0.9299   Median :0.2615  
##  Mean   :0.9348   Mean   :0.2663  
##  3rd Qu.:1.1501   3rd Qu.:0.3134  
##  Max.   :1.9982   Max.   :0.5270</code></pre>
</div>
<div id="parametric-bootstrap" class="section level2">
<h2><span class="header-section-number">8.2</span> Parametric Bootstrap</h2>
<p>A parametric model is specified to the data, and the model parameters
are estimated by likelihood methods, moment methods, or other methods.
Parametric bootstrap samples are generated from the fitted model, and
for each sample the quantity to be bootstrapped is calculated.</p>
<p>Parametric bootstrap is often used to approximate the null
distribution of a testing statistic which is otherwise unwieldy.
The uncertainty of parameter estimation can be accounted for.</p>
<div id="goodness-of-fit-test" class="section level3">
<h3><span class="header-section-number">8.2.1</span> Goodness-of-Fit Test</h3>
<p>Goodness of fit test with the KS statistic.
Consider two different null hypotheses:
<span class="math display">\[
H_0: \mbox{ the data follows $N(2, 2^2)$ distribution,}
\]</span>
and
<span class="math display">\[
H_0: \mbox{ the data follows a normal distribution.}
\]</span>
Note that the first hypothesis is a simple hypothesis while the second one is a composite hypothesis.</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb172-1" data-line-number="1">do1rep &lt;-<span class="st"> </span><span class="cf">function</span>(n) {</a>
<a class="sourceLine" id="cb172-2" data-line-number="2">  x &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n, <span class="dt">mean =</span> <span class="dv">2</span>, <span class="dt">sd =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb172-3" data-line-number="3">  p1 &lt;-<span class="st"> </span><span class="kw">ks.test</span>(x, <span class="st">&quot;pnorm&quot;</span>, <span class="dt">mean =</span> <span class="dv">2</span>, <span class="dt">sd =</span> <span class="dv">2</span>)<span class="op">$</span>p.value</a>
<a class="sourceLine" id="cb172-4" data-line-number="4">  p2 &lt;-<span class="st"> </span><span class="kw">ks.test</span>(x, <span class="st">&quot;pnorm&quot;</span>, <span class="dt">mean =</span> <span class="kw">mean</span>(x), <span class="dt">sd =</span> <span class="kw">sd</span>(x))<span class="op">$</span>p.value</a>
<a class="sourceLine" id="cb172-5" data-line-number="5">  <span class="kw">c</span>(p1, p2)</a>
<a class="sourceLine" id="cb172-6" data-line-number="6">}</a>
<a class="sourceLine" id="cb172-7" data-line-number="7"></a>
<a class="sourceLine" id="cb172-8" data-line-number="8"><span class="kw">set.seed</span>(<span class="dv">2020-12-01</span>)</a>
<a class="sourceLine" id="cb172-9" data-line-number="9">pvals &lt;-<span class="st"> </span><span class="kw">replicate</span>(<span class="dv">1000</span>, <span class="kw">do1rep</span>(<span class="dv">100</span>))</a>
<a class="sourceLine" id="cb172-10" data-line-number="10"></a>
<a class="sourceLine" id="cb172-11" data-line-number="11">## par(mfrow=c(1, 2), mar=c(2.5, 2.5, 0.1, 0.1), mgp=c(1.5, 0.5, 0))</a>
<a class="sourceLine" id="cb172-12" data-line-number="12"><span class="kw">hist</span>(pvals[<span class="dv">1</span>,])</a></code></pre></div>
<p><img src="07-boot_files/figure-html/gofNaive-1.png" width="672" /></p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb173-1" data-line-number="1"><span class="kw">hist</span>(pvals[<span class="dv">2</span>,])</a></code></pre></div>
<p><img src="07-boot_files/figure-html/gofNaive-2.png" width="672" /></p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb174-1" data-line-number="1"><span class="kw">ks.test</span>(pvals[<span class="dv">1</span>,], <span class="st">&quot;punif&quot;</span>)</a></code></pre></div>
<pre><code>## 
##  One-sample Kolmogorov-Smirnov test
## 
## data:  pvals[1, ]
## D = 0.043786, p-value = 0.04322
## alternative hypothesis: two-sided</code></pre>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb176-1" data-line-number="1"><span class="kw">ks.test</span>(pvals[<span class="dv">2</span>,], <span class="st">&quot;punif&quot;</span>)</a></code></pre></div>
<pre><code>## 
##  One-sample Kolmogorov-Smirnov test
## 
## data:  pvals[2, ]
## D = 0.47133, p-value &lt; 2.2e-16
## alternative hypothesis: two-sided</code></pre>
<p>Compare the histograms of the p-values obtained from applying <code>ks.test()</code> to <span class="math inline">\(N(2, 2^2)\)</span> and to <span class="math inline">\(N(\hat\mu, \hat\sigma^2)\)</span> with fitted mean <span class="math inline">\(\hat\mu\)</span> and variance <span class="math inline">\(\hat\sigma^2\)</span>. The first one is what is expected from a <span class="math inline">\(U(0, 1)\)</span> distribution, but the second one is not, which confirms that direct application of <code>ks.test()</code> to fitted distribution is incorrect for the goodness-of-fit of the hypothesized distribution with unknown parameters that need to be estimated.</p>
<p>A parametric bootstrap procedure can be employed for such tests. The test statistic remain the same, but its null distribution is approximated from parametric bootstrap.</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb178-1" data-line-number="1">my.ks.normal &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">B =</span> <span class="dv">1000</span>) {</a>
<a class="sourceLine" id="cb178-2" data-line-number="2">  ## mle</a>
<a class="sourceLine" id="cb178-3" data-line-number="3">  mu &lt;-<span class="st"> </span><span class="kw">mean</span>(x)</a>
<a class="sourceLine" id="cb178-4" data-line-number="4">  sigma &lt;-<span class="st"> </span><span class="kw">sd</span>(x)</a>
<a class="sourceLine" id="cb178-5" data-line-number="5">  ## KS stat</a>
<a class="sourceLine" id="cb178-6" data-line-number="6">  stat &lt;-<span class="st"> </span><span class="kw">ks.test</span>(x, <span class="st">&quot;pnorm&quot;</span>, mu, sigma)<span class="op">$</span>statistic</a>
<a class="sourceLine" id="cb178-7" data-line-number="7">  ## parametric bootstrap to approximate the null distribution</a>
<a class="sourceLine" id="cb178-8" data-line-number="8">  n &lt;-<span class="st"> </span><span class="kw">length</span>(x)</a>
<a class="sourceLine" id="cb178-9" data-line-number="9">  stat.b &lt;-<span class="st"> </span><span class="kw">double</span>(B)</a>
<a class="sourceLine" id="cb178-10" data-line-number="10">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>B) {</a>
<a class="sourceLine" id="cb178-11" data-line-number="11">    x.b &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n, mu, sigma)</a>
<a class="sourceLine" id="cb178-12" data-line-number="12">    mu.b &lt;-<span class="st"> </span><span class="kw">mean</span>(x.b)</a>
<a class="sourceLine" id="cb178-13" data-line-number="13">    sigma.b &lt;-<span class="st"> </span><span class="kw">sd</span>(x.b)</a>
<a class="sourceLine" id="cb178-14" data-line-number="14">    stat.b[i] &lt;-<span class="st"> </span><span class="kw">ks.test</span>(x.b, <span class="st">&quot;pnorm&quot;</span>, mu.b, sigma.b)<span class="op">$</span>statistic</a>
<a class="sourceLine" id="cb178-15" data-line-number="15">  }</a>
<a class="sourceLine" id="cb178-16" data-line-number="16">  p.value &lt;-<span class="st"> </span>(<span class="kw">sum</span>(stat.b <span class="op">&gt;=</span><span class="st"> </span>stat) <span class="op">+</span><span class="st"> </span><span class="fl">0.5</span>) <span class="op">/</span><span class="st"> </span>(B <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb178-17" data-line-number="17">  <span class="kw">list</span>(<span class="dt">statistics =</span> stat, <span class="dt">p.value =</span> p.value, </a>
<a class="sourceLine" id="cb178-18" data-line-number="18">       <span class="dt">estimate =</span> <span class="kw">c</span>(<span class="dt">mean =</span> mu, <span class="dt">sd =</span> sigma),</a>
<a class="sourceLine" id="cb178-19" data-line-number="19">       <span class="dt">stat.sim =</span> stat.b)</a>
<a class="sourceLine" id="cb178-20" data-line-number="20">}</a>
<a class="sourceLine" id="cb178-21" data-line-number="21"></a>
<a class="sourceLine" id="cb178-22" data-line-number="22">pvals &lt;-<span class="st"> </span><span class="kw">replicate</span>(<span class="dv">1000</span>, <span class="kw">my.ks.normal</span>(<span class="kw">rnorm</span>(<span class="dv">100</span>, <span class="dv">2</span>, <span class="dv">2</span>), <span class="dt">B =</span> <span class="dv">200</span>)<span class="op">$</span>p.value)</a>
<a class="sourceLine" id="cb178-23" data-line-number="23">## check the distribution of the pvals</a>
<a class="sourceLine" id="cb178-24" data-line-number="24"><span class="kw">hist</span>(pvals)</a></code></pre></div>
<p><img src="07-boot_files/figure-html/gof-pb-1.png" width="672" /></p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb179-1" data-line-number="1"><span class="kw">ks.test</span>(pvals, <span class="st">&quot;punif&quot;</span>) </a></code></pre></div>
<pre><code>## Warning in ks.test(pvals, &quot;punif&quot;): ties should not be present for the
## Kolmogorov-Smirnov test</code></pre>
<pre><code>## 
##  One-sample Kolmogorov-Smirnov test
## 
## data:  pvals
## D = 0.042632, p-value = 0.05277
## alternative hypothesis: two-sided</code></pre>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb182-1" data-line-number="1">## this is not good because pvals has only (B + 1) possible values</a>
<a class="sourceLine" id="cb182-2" data-line-number="2">## while ks.test cannot handle data with ties</a>
<a class="sourceLine" id="cb182-3" data-line-number="3"></a>
<a class="sourceLine" id="cb182-4" data-line-number="4">## check the distribution of the testing statistics</a>
<a class="sourceLine" id="cb182-5" data-line-number="5">stat.naive &lt;-<span class="st"> </span><span class="kw">replicate</span>(<span class="dv">1000</span>, <span class="kw">ks.test</span>(<span class="kw">rnorm</span>(<span class="dv">100</span>, <span class="dv">2</span>, <span class="dv">2</span>), <span class="st">&quot;pnorm&quot;</span>, <span class="dv">2</span>, <span class="dv">2</span>)<span class="op">$</span>statistic)</a>
<a class="sourceLine" id="cb182-6" data-line-number="6">## compare with the empirical distribution</a>
<a class="sourceLine" id="cb182-7" data-line-number="7">stat.pb &lt;-<span class="st"> </span><span class="kw">replicate</span>(<span class="dv">200</span>, <span class="kw">my.ks.normal</span>(<span class="kw">rnorm</span>(<span class="dv">100</span>, <span class="dv">2</span>, <span class="dv">2</span>), <span class="dt">B =</span> <span class="dv">200</span>)<span class="op">$</span>statistic)</a>
<a class="sourceLine" id="cb182-8" data-line-number="8">## plot them</a>
<a class="sourceLine" id="cb182-9" data-line-number="9">dens.naive &lt;-<span class="st"> </span><span class="kw">density</span>(stat.naive)</a>
<a class="sourceLine" id="cb182-10" data-line-number="10">dens.pb &lt;-<span class="st"> </span><span class="kw">density</span>(stat.pb)</a>
<a class="sourceLine" id="cb182-11" data-line-number="11">## note that stat.pb tends to be smaller than stat.naiv</a>
<a class="sourceLine" id="cb182-12" data-line-number="12"><span class="kw">plot</span>(dens.pb, <span class="dt">xlim =</span> <span class="kw">range</span>(dens.naive<span class="op">$</span>x))</a>
<a class="sourceLine" id="cb182-13" data-line-number="13"><span class="kw">lines</span>(<span class="kw">density</span>(stat.naive), <span class="dt">lty=</span><span class="dv">2</span>)</a></code></pre></div>
<p><img src="07-boot_files/figure-html/gof-pb-2.png" width="672" />
Note that the KS statistic and the CvM statistic are functionals
of the empirical distribution and the fitted parametric distribution.
Faster alternatives are possible with the multiplier CLT
<span class="citation">(Kojadinovic and Yan <a href="#ref-Koja:Yan:good:2012">2012</a>)</span>.</p>
<p>Chi-squared test is another goodness-of-fit test. Here is an example of
testing for generalized Pareto distribution. The correct degrees of freedom
depends on the estimation method <span class="citation">(Chernoff and Lehmann <a href="#ref-chernoff1954use">1954</a>)</span>.</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb183-1" data-line-number="1">n &lt;-<span class="st"> </span><span class="dv">500</span></a>
<a class="sourceLine" id="cb183-2" data-line-number="2">theta &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">scale =</span> <span class="dv">1</span>, <span class="dt">shape =</span> <span class="fl">.2</span>)</a>
<a class="sourceLine" id="cb183-3" data-line-number="3">x &lt;-<span class="st"> </span>texmex<span class="op">::</span><span class="kw">rgpd</span>(n, <span class="dt">sigma =</span> theta[<span class="dv">1</span>], <span class="dt">xi =</span> theta[<span class="dv">2</span>])</a>
<a class="sourceLine" id="cb183-4" data-line-number="4">fit &lt;-<span class="st"> </span>evir<span class="op">::</span><span class="kw">gpd</span>(x, <span class="dt">threshold =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb183-5" data-line-number="5"></a>
<a class="sourceLine" id="cb183-6" data-line-number="6">my_chisq_test &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">bins =</span> <span class="kw">seq</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="dt">by =</span> <span class="fl">0.1</span>), <span class="dt">B =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb183-7" data-line-number="7">                          <span class="dt">method =</span> <span class="kw">c</span>(<span class="st">&quot;ml&quot;</span>, <span class="st">&quot;minchisq&quot;</span>)) {</a>
<a class="sourceLine" id="cb183-8" data-line-number="8">    getstat &lt;-<span class="st"> </span><span class="cf">function</span>(x, thetahat, bins) {</a>
<a class="sourceLine" id="cb183-9" data-line-number="9">        pp &lt;-<span class="st"> </span><span class="kw">diff</span>(<span class="kw">c</span>(<span class="dv">0</span>, bins, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb183-10" data-line-number="10">        qx &lt;-<span class="st"> </span><span class="kw">quantile</span>(x, bins)</a>
<a class="sourceLine" id="cb183-11" data-line-number="11">        p &lt;-<span class="st"> </span>texmex<span class="op">::</span><span class="kw">pgpd</span>(qx, <span class="dt">sigma =</span> thetahat[<span class="dv">2</span>], <span class="dt">xi =</span> thetahat[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb183-12" data-line-number="12">        freq &lt;-<span class="st"> </span><span class="kw">diff</span>(n <span class="op">*</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, p, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb183-13" data-line-number="13">        <span class="kw">chisq.test</span>(<span class="dt">x =</span> freq, <span class="dt">p =</span> pp)<span class="op">$</span>statistic</a>
<a class="sourceLine" id="cb183-14" data-line-number="14">    }</a>
<a class="sourceLine" id="cb183-15" data-line-number="15">    min_chisq &lt;-<span class="st"> </span><span class="cf">function</span>(x, init, bins) {</a>
<a class="sourceLine" id="cb183-16" data-line-number="16">        fit &lt;-<span class="st"> </span><span class="kw">optim</span>(init,</a>
<a class="sourceLine" id="cb183-17" data-line-number="17">                     <span class="cf">function</span>(th) <span class="kw">getstat</span>(x, th, bins))</a>
<a class="sourceLine" id="cb183-18" data-line-number="18">        fit</a>
<a class="sourceLine" id="cb183-19" data-line-number="19">    }</a>
<a class="sourceLine" id="cb183-20" data-line-number="20">    method &lt;-<span class="st"> </span><span class="kw">match.arg</span>(method)</a>
<a class="sourceLine" id="cb183-21" data-line-number="21">    ## observed stat</a>
<a class="sourceLine" id="cb183-22" data-line-number="22">    n &lt;-<span class="st"> </span><span class="kw">length</span>(x)</a>
<a class="sourceLine" id="cb183-23" data-line-number="23">    thetahat &lt;-<span class="st"> </span>evir<span class="op">::</span><span class="kw">gpd</span>(x, <span class="dt">threshold =</span> <span class="dv">0</span>)<span class="op">$</span>par.ests</a>
<a class="sourceLine" id="cb183-24" data-line-number="24">    <span class="cf">if</span> (method <span class="op">==</span><span class="st"> &quot;minchisq&quot;</span>) thetahat &lt;-<span class="st"> </span><span class="kw">min_chisq</span>(x, thetahat, bins)<span class="op">$</span>par</a>
<a class="sourceLine" id="cb183-25" data-line-number="25">    stat &lt;-<span class="st"> </span><span class="kw">getstat</span>(x, thetahat, bins)</a>
<a class="sourceLine" id="cb183-26" data-line-number="26">    <span class="cf">if</span> (B <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span>) <span class="kw">return</span>(stat)</a>
<a class="sourceLine" id="cb183-27" data-line-number="27"></a>
<a class="sourceLine" id="cb183-28" data-line-number="28">    ## bootstrap stat</a>
<a class="sourceLine" id="cb183-29" data-line-number="29">    stat.b &lt;-<span class="st"> </span><span class="kw">double</span>(B)</a>
<a class="sourceLine" id="cb183-30" data-line-number="30">      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>B) {</a>
<a class="sourceLine" id="cb183-31" data-line-number="31">        x.b &lt;-<span class="st"> </span>texmex<span class="op">::</span><span class="kw">rgpd</span>(n, <span class="dt">sigma =</span> thetahat[<span class="dv">2</span>], <span class="dt">xi =</span> thetahat[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb183-32" data-line-number="32">        thetahat.b &lt;-<span class="st"> </span>evir<span class="op">::</span><span class="kw">gpd</span>(x.b, <span class="dt">threshold =</span> <span class="dv">0</span>)<span class="op">$</span>par.ests</a>
<a class="sourceLine" id="cb183-33" data-line-number="33">        <span class="cf">if</span> (method <span class="op">==</span><span class="st"> &quot;minchisq&quot;</span>) thetahat.b &lt;-<span class="st"> </span><span class="kw">min_chisq</span>(x.b, thetahat.b, bins)<span class="op">$</span>par</a>
<a class="sourceLine" id="cb183-34" data-line-number="34">        stat.b[i] &lt;-<span class="st"> </span><span class="kw">getstat</span>(x.b, thetahat.b, bins)</a>
<a class="sourceLine" id="cb183-35" data-line-number="35">      }</a>
<a class="sourceLine" id="cb183-36" data-line-number="36">      p.value &lt;-<span class="st"> </span>(<span class="kw">sum</span>(stat.b <span class="op">&gt;=</span><span class="st"> </span>stat) <span class="op">+</span><span class="st"> </span><span class="fl">0.5</span>) <span class="op">/</span><span class="st"> </span>(B <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb183-37" data-line-number="37">      <span class="kw">list</span>(<span class="dt">statistics =</span> stat, <span class="dt">p.value =</span> p.value, </a>
<a class="sourceLine" id="cb183-38" data-line-number="38">           <span class="dt">estimate =</span> thetahat,</a>
<a class="sourceLine" id="cb183-39" data-line-number="39">           <span class="dt">stat.sim =</span> stat.b)</a>
<a class="sourceLine" id="cb183-40" data-line-number="40">}</a>
<a class="sourceLine" id="cb183-41" data-line-number="41"></a>
<a class="sourceLine" id="cb183-42" data-line-number="42"><span class="kw">my_chisq_test</span>(x)<span class="op">$</span>p.value</a></code></pre></div>
<pre><code>## [1] 0.6938062</code></pre>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb185-1" data-line-number="1">y &lt;-<span class="st"> </span><span class="kw">rlnorm</span>(<span class="dv">500</span>)</a>
<a class="sourceLine" id="cb185-2" data-line-number="2"><span class="kw">my_chisq_test</span>(y)<span class="op">$</span>p.value</a></code></pre></div>
<pre><code>## [1] 0.007492507</code></pre>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb187-1" data-line-number="1">## replicated p-value should follow U(0, 1) under H0</a>
<a class="sourceLine" id="cb187-2" data-line-number="2">## pvals &lt;- replicate(500, my_chisq_test(texmex::rgpd(n, sigma = theta[1], xi = theta[2]))$p.value)</a>
<a class="sourceLine" id="cb187-3" data-line-number="3"></a>
<a class="sourceLine" id="cb187-4" data-line-number="4">## compare the distribution of the testing statistic with chi-squared</a>
<a class="sourceLine" id="cb187-5" data-line-number="5">stat.ch &lt;-<span class="st"> </span><span class="kw">replicate</span>(<span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb187-6" data-line-number="6">                     <span class="kw">my_chisq_test</span>(texmex<span class="op">::</span><span class="kw">rgpd</span>(n, <span class="dt">sigma=</span>theta[<span class="dv">2</span>], <span class="dt">xi=</span>theta[<span class="dv">1</span>]),</a>
<a class="sourceLine" id="cb187-7" data-line-number="7">                                   <span class="dt">B =</span> <span class="dv">0</span>, <span class="dt">method =</span> <span class="st">&quot;minchisq&quot;</span>))</a>
<a class="sourceLine" id="cb187-8" data-line-number="8">stat.ml &lt;-<span class="st"> </span><span class="kw">replicate</span>(<span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb187-9" data-line-number="9">                     <span class="kw">my_chisq_test</span>(texmex<span class="op">::</span><span class="kw">rgpd</span>(n, <span class="dt">sigma=</span>theta[<span class="dv">2</span>], <span class="dt">xi=</span>theta[<span class="dv">1</span>]),</a>
<a class="sourceLine" id="cb187-10" data-line-number="10">                                   <span class="dt">B =</span> <span class="dv">0</span>, <span class="dt">method =</span> <span class="st">&quot;ml&quot;</span>))</a>
<a class="sourceLine" id="cb187-11" data-line-number="11"></a>
<a class="sourceLine" id="cb187-12" data-line-number="12">## hist(stat.ml, prob=TRUE, breaks = 30)</a>
<a class="sourceLine" id="cb187-13" data-line-number="13"><span class="kw">plot</span>(<span class="kw">density</span>(stat.ch))</a>
<a class="sourceLine" id="cb187-14" data-line-number="14">kdens &lt;-<span class="st"> </span><span class="kw">density</span>(stat.ml)</a>
<a class="sourceLine" id="cb187-15" data-line-number="15"><span class="kw">lines</span>(kdens<span class="op">$</span>x, kdens<span class="op">$</span>y, <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>)</a>
<a class="sourceLine" id="cb187-16" data-line-number="16"><span class="kw">curve</span>(<span class="kw">dchisq</span>(x, <span class="dt">df =</span> <span class="dv">7</span>), <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</a>
<a class="sourceLine" id="cb187-17" data-line-number="17"><span class="kw">curve</span>(<span class="kw">dchisq</span>(x, <span class="dt">df =</span> <span class="dv">9</span>), <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">col =</span> <span class="st">&quot;purple&quot;</span>)</a></code></pre></div>
<p><img src="07-boot_files/figure-html/chisq-1.png" width="672" /></p>
</div>
</div>
<div id="block-bootstrap" class="section level2">
<h2><span class="header-section-number">8.3</span> Block bootstrap</h2>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb188-1" data-line-number="1">n &lt;-<span class="st"> </span><span class="dv">200</span></a>
<a class="sourceLine" id="cb188-2" data-line-number="2">x &lt;-<span class="st"> </span>stats<span class="op">::</span><span class="kw">arima.sim</span>(<span class="kw">list</span>(<span class="dt">ar =</span> <span class="fl">0.5</span>), n) <span class="op">+</span><span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb188-3" data-line-number="3"></a>
<a class="sourceLine" id="cb188-4" data-line-number="4">nmblk &lt;-<span class="st"> </span><span class="cf">function</span>(n, l) {</a>
<a class="sourceLine" id="cb188-5" data-line-number="5">    b &lt;-<span class="st"> </span>n <span class="op">/</span><span class="st"> </span>l <span class="co"># assuming that is an integer</span></a>
<a class="sourceLine" id="cb188-6" data-line-number="6">    idx &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">seq</span>(<span class="dv">1</span>, n <span class="op">-</span><span class="st"> </span>l <span class="op">+</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">by =</span> l), b, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb188-7" data-line-number="7">    <span class="kw">c</span>(<span class="kw">outer</span>(<span class="dv">0</span><span class="op">:</span>(l <span class="op">-</span><span class="st"> </span><span class="dv">1</span>), idx, <span class="st">&quot;+&quot;</span>))</a>
<a class="sourceLine" id="cb188-8" data-line-number="8">}</a>
<a class="sourceLine" id="cb188-9" data-line-number="9"></a>
<a class="sourceLine" id="cb188-10" data-line-number="10">mvblk &lt;-<span class="st"> </span><span class="cf">function</span>(n, l) {</a>
<a class="sourceLine" id="cb188-11" data-line-number="11">    b &lt;-<span class="st"> </span>n <span class="op">/</span><span class="st"> </span>l</a>
<a class="sourceLine" id="cb188-12" data-line-number="12">    idx &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span>(n <span class="op">-</span><span class="st"> </span>l <span class="op">+</span><span class="st"> </span><span class="dv">1</span>), b, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb188-13" data-line-number="13">    <span class="kw">c</span>(<span class="kw">outer</span>(<span class="dv">0</span><span class="op">:</span>(l <span class="op">-</span><span class="st"> </span><span class="dv">1</span>), idx, <span class="st">&quot;+&quot;</span>))</a>
<a class="sourceLine" id="cb188-14" data-line-number="14">}</a>
<a class="sourceLine" id="cb188-15" data-line-number="15">      </a>
<a class="sourceLine" id="cb188-16" data-line-number="16"></a>
<a class="sourceLine" id="cb188-17" data-line-number="17">blkboot &lt;-<span class="st"> </span><span class="cf">function</span>(tseries, statistic, R, l) {</a>
<a class="sourceLine" id="cb188-18" data-line-number="18">    n &lt;-<span class="st"> </span><span class="kw">length</span>(tseries)</a>
<a class="sourceLine" id="cb188-19" data-line-number="19">    ## observed statistic</a>
<a class="sourceLine" id="cb188-20" data-line-number="20">    stat &lt;-<span class="st"> </span><span class="kw">statistic</span>(tseries)</a>
<a class="sourceLine" id="cb188-21" data-line-number="21">    ## nonmoving block bootstrap</a>
<a class="sourceLine" id="cb188-22" data-line-number="22">    nm.stat &lt;-<span class="st"> </span><span class="kw">replicate</span>(R, <span class="kw">statistic</span>(tseries[<span class="kw">nmblk</span>(n, l)]))</a>
<a class="sourceLine" id="cb188-23" data-line-number="23">    ## moving block bootstrap</a>
<a class="sourceLine" id="cb188-24" data-line-number="24">    mv.stat &lt;-<span class="st"> </span><span class="kw">replicate</span>(R, <span class="kw">statistic</span>(tseries[<span class="kw">mvblk</span>(n, l)]))</a>
<a class="sourceLine" id="cb188-25" data-line-number="25">    <span class="kw">list</span>(<span class="dt">stat =</span> stat, <span class="dt">nm.stat =</span> nm.stat, <span class="dt">mv.stat =</span> mv.stat)</a>
<a class="sourceLine" id="cb188-26" data-line-number="26">}</a>
<a class="sourceLine" id="cb188-27" data-line-number="27"></a>
<a class="sourceLine" id="cb188-28" data-line-number="28">## an experiment</a>
<a class="sourceLine" id="cb188-29" data-line-number="29">ar1 &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">cor</span>(x[<span class="op">-</span><span class="dv">1</span>], x[<span class="op">-</span><span class="kw">length</span>(x)])</a>
<a class="sourceLine" id="cb188-30" data-line-number="30"></a>
<a class="sourceLine" id="cb188-31" data-line-number="31">do1rep &lt;-<span class="st"> </span><span class="cf">function</span>(n, theta, l) {</a>
<a class="sourceLine" id="cb188-32" data-line-number="32">    x &lt;-<span class="st"> </span><span class="kw">arima.sim</span>(<span class="kw">list</span>(<span class="dt">ar =</span> theta), n)</a>
<a class="sourceLine" id="cb188-33" data-line-number="33">    bt &lt;-<span class="st"> </span><span class="kw">blkboot</span>(x, ar1, <span class="dv">1000</span>, l)</a>
<a class="sourceLine" id="cb188-34" data-line-number="34">    <span class="kw">c</span>(bt<span class="op">$</span>stat, <span class="kw">sd</span>(bt<span class="op">$</span>nm.stat), <span class="kw">sd</span>(bt<span class="op">$</span>mv.stat))</a>
<a class="sourceLine" id="cb188-35" data-line-number="35">}</a>
<a class="sourceLine" id="cb188-36" data-line-number="36"></a>
<a class="sourceLine" id="cb188-37" data-line-number="37">sim &lt;-<span class="st"> </span><span class="kw">replicate</span>(<span class="dv">200</span>, <span class="kw">do1rep</span>(<span class="dv">100</span>, <span class="fl">0.5</span>, <span class="dv">10</span>))</a></code></pre></div>
</div>
<div id="semiparametric-bootstrap" class="section level2">
<h2><span class="header-section-number">8.4</span> Semiparametric bootstrap</h2>
<p><span class="citation">Heffernan and Tawn (<a href="#ref-Heff:Tawn:cond:2004">2004</a>)</span> applied a semiparametric bootstrap method <span class="citation">(Davison <a href="#ref-Davi:Hink:boot:1997">1997</a>)</span> in multivariate extreme value modeling. The challenge here is that, although univariate margins are fitted fine with generalized extreme value (GEV) distributions, an extreme-value dependence structure may be too strong an assumption to be practical. How does one obtain bootstrap samples of a semiparametric model where the marginal models are specified but the dependence structure is not?</p>
<p>To ensure that the bootstrap samples replicate both the marginal and the dependence features ofthe data, <span class="citation">Heffernan and Tawn (<a href="#ref-Heff:Tawn:cond:2004">2004</a>)</span> proposed a two-step bootstrap algorithm. A nonparametric bootstrap is employed first, ensuring the preservation of the dependence structure; then a parametric step is carried out to assess the uncertainty in the estimation of the parametric marginal models. The precise procedure is as follows. The original data are first transformed to have Gumbel margins using the fitted marginal models from the original data. A nonparametric bootstrap sample is then obtained by sampling with replacement from the transformed data. We then change the marginal values of this bootstrap sample, ensuring that the marginal distributions are all Gumbel and preserving the associations between the ranked points in each component. Specifically, for each <span class="math inline">\(i\)</span>, <span class="math inline">\(i = 1, \ldots, d\)</span>, where <span class="math inline">\(d\)</span> is the multivariate dimension, replace the ordered sample of component <span class="math inline">\(Y_i\)</span> with an ordered sample of the same size from the standard Gumbel distribution. The resulting sample is then transformed back to the original margins by using the marginal model that was estimated from the original data. The bootstrap samples obtained this way have desired univariate marginal distributions and dependence structure entirely consistent with the data as determined by the associations between the ranks of the components of the variables.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb189-1" data-line-number="1">bootHT &lt;-<span class="st"> </span><span class="cf">function</span>(rkmat) {</a>
<a class="sourceLine" id="cb189-2" data-line-number="2">  nr &lt;-<span class="st"> </span><span class="kw">nrow</span>(rkmat)</a>
<a class="sourceLine" id="cb189-3" data-line-number="3">  nc &lt;-<span class="st"> </span><span class="kw">ncol</span>(rkmat)</a>
<a class="sourceLine" id="cb189-4" data-line-number="4">  ## resampling rows</a>
<a class="sourceLine" id="cb189-5" data-line-number="5">  idx &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span>nr, nr, <span class="dt">replace=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb189-6" data-line-number="6">  rkmat.bt &lt;-<span class="st"> </span>rkmat[idx, ]</a>
<a class="sourceLine" id="cb189-7" data-line-number="7">  ## reordering iid uniform variables for each column</a>
<a class="sourceLine" id="cb189-8" data-line-number="8">  vv &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">runif</span>(nr <span class="op">*</span><span class="st"> </span>nc), nr, nc)</a>
<a class="sourceLine" id="cb189-9" data-line-number="9">  <span class="kw">sapply</span>(<span class="dv">1</span><span class="op">:</span>nc, <span class="cf">function</span>(i) <span class="kw">sort</span>(vv[,i])[rkmat.bt[,i]])</a>
<a class="sourceLine" id="cb189-10" data-line-number="10">}</a>
<a class="sourceLine" id="cb189-11" data-line-number="11"></a>
<a class="sourceLine" id="cb189-12" data-line-number="12">ns &lt;-<span class="st"> </span><span class="dv">6</span></a>
<a class="sourceLine" id="cb189-13" data-line-number="13">nt &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb189-14" data-line-number="14">umat &lt;-<span class="st"> </span>copula<span class="op">::</span><span class="kw">rCopula</span>(nt, copula<span class="op">::</span><span class="kw">normalCopula</span>(<span class="fl">0.6</span>, <span class="dt">dim =</span> ns, <span class="dt">dispstr =</span> <span class="st">&quot;ar1&quot;</span>))</a>
<a class="sourceLine" id="cb189-15" data-line-number="15">rkmat &lt;-<span class="st"> </span><span class="kw">apply</span>(umat, <span class="dv">2</span>, rank, <span class="dt">ties.method =</span> <span class="st">&quot;random&quot;</span>)</a>
<a class="sourceLine" id="cb189-16" data-line-number="16"><span class="kw">set.seed</span>(<span class="dv">123</span>)</a>
<a class="sourceLine" id="cb189-17" data-line-number="17">umat.bt &lt;-<span class="st"> </span><span class="kw">bootHT</span>(rkmat)</a>
<a class="sourceLine" id="cb189-18" data-line-number="18"></a>
<a class="sourceLine" id="cb189-19" data-line-number="19">ht &lt;-<span class="st"> </span><span class="kw">replicate</span>(<span class="dv">1000</span>, <span class="kw">bootHT</span>(rkmat))</a>
<a class="sourceLine" id="cb189-20" data-line-number="20"><span class="kw">str</span>(ht)</a></code></pre></div>
<pre><code>##  num [1:10, 1:6, 1:1000] 0.344 0.333 0.467 0.188 0.467 ...</code></pre>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb191-1" data-line-number="1"><span class="kw">hist</span>(ht[<span class="dv">3</span>, <span class="dv">3</span>, ])</a></code></pre></div>
<p><img src="07-boot_files/figure-html/bootHT-1.png" width="672" /></p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb192-1" data-line-number="1"><span class="kw">hist</span>(ht[<span class="dv">4</span>, <span class="dv">5</span>, ])</a></code></pre></div>
<p><img src="07-boot_files/figure-html/bootHT-2.png" width="672" /></p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb193-1" data-line-number="1"><span class="kw">plot</span>(ht[<span class="dv">2</span>, <span class="dv">3</span>, ], ht[<span class="dv">2</span>, <span class="dv">4</span>, ])</a></code></pre></div>
<p><img src="07-boot_files/figure-html/bootHT-3.png" width="672" /></p>
<p>What if the data is not balanced and the blocks are of different sizes?</p>
</div>
<div id="multiplier-bootstrap" class="section level2">
<h2><span class="header-section-number">8.5</span> Multiplier bootstrap</h2>
<div id="multiplier-central-limit-theorem" class="section level3">
<h3><span class="header-section-number">8.5.1</span> Multiplier central limit theorem</h3>
<p>The theoretical background and presentation of the multiplier CLT
can be found in Section~2.9 of <span class="citation">Van Der Vaart and Wellner (<a href="#ref-van:Well:weak:1996">1996</a>)</span>.
Let <span class="math inline">\(X_1, \ldots, X_n\)</span> be a random sample from a distribution <span class="math inline">\(P\)</span>.
Let <span class="math inline">\(\delta_x(t) = I(x &lt;= t)\)</span>.
With the notation <span class="math inline">\(Z_i(t) = \delta_{X_i}(t) - P(t)\)</span>, the empirical
CLT can be written as
<span class="math display">\[
\frac{1}{\sqrt{n}} \sum_{i = 1}^n Z_i \to \mathbb{G}
\]</span>
where <span class="math inline">\(\mathbb{G}\)</span> is a Brownian bridge.</p>
<p>Let <span class="math inline">\(\xi_1, \ldots, \xi_n\)</span> be a set of iid random variables with
mean zero and variance 1, and independent of <span class="math inline">\(X_1, \ldots, X_n\)</span>.
The multiplier CLT asserts that
<span class="math display">\[
\frac{1}{\sqrt{n}} \sum_{i=1}^n \xi_i Z_i \to \mathbb{G},
\]</span>
under some conditions about the (Donsker) class of the distribution <span class="math inline">\(P\)</span>.</p>
<p>A more refined and deeper result is the conditional multiplier CLT
which states that
<span class="math display">\[
\frac{1}{\sqrt{n}} \sum_{i=1}^n \xi_i Z_i \to \mathbb{G},
\]</span>
given almost every sequence of <span class="math inline">\(Z_i, Z_2, \ldots\)</span>, under
only slightly stronger conditions.</p>
<p>For illustration, consider a scalar. We first look at the unconditional version; that is, the observed data is not fixed.</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb194-1" data-line-number="1">n &lt;-<span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb194-2" data-line-number="2">nrep &lt;-<span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb194-3" data-line-number="3"></a>
<a class="sourceLine" id="cb194-4" data-line-number="4">## CLT and Multiplier CLT</a>
<a class="sourceLine" id="cb194-5" data-line-number="5">do1rep &lt;-<span class="st"> </span><span class="cf">function</span>(n) {</a>
<a class="sourceLine" id="cb194-6" data-line-number="6">  x &lt;-<span class="st"> </span><span class="kw">rexp</span>(n)</a>
<a class="sourceLine" id="cb194-7" data-line-number="7">  z1 &lt;-<span class="st"> </span><span class="kw">sum</span>(x <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(n)</a>
<a class="sourceLine" id="cb194-8" data-line-number="8">  z2 &lt;-<span class="st"> </span><span class="kw">sum</span>((x <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span><span class="kw">rnorm</span>(n)) <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(n)</a>
<a class="sourceLine" id="cb194-9" data-line-number="9">  z3 &lt;-<span class="st"> </span><span class="kw">sum</span>((x <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span><span class="kw">ifelse</span>(<span class="kw">runif</span>(n) <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">-1</span>)) <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(n)</a>
<a class="sourceLine" id="cb194-10" data-line-number="10">  <span class="kw">c</span>(z1, z2, z3)</a>
<a class="sourceLine" id="cb194-11" data-line-number="11">}</a>
<a class="sourceLine" id="cb194-12" data-line-number="12"></a>
<a class="sourceLine" id="cb194-13" data-line-number="13">clt &lt;-<span class="st"> </span><span class="kw">replicate</span>(nrep, <span class="kw">do1rep</span>(n))</a>
<a class="sourceLine" id="cb194-14" data-line-number="14"></a>
<a class="sourceLine" id="cb194-15" data-line-number="15">## check normality of each component</a>
<a class="sourceLine" id="cb194-16" data-line-number="16"><span class="kw">qqnorm</span>(clt[<span class="dv">1</span>,], <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>), <span class="dt">main =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb194-17" data-line-number="17"><span class="kw">qqline</span>(clt[<span class="dv">1</span>,])</a></code></pre></div>
<p><img src="07-boot_files/figure-html/multScalar-1.png" width="672" /></p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb195-1" data-line-number="1"><span class="kw">qqnorm</span>(clt[<span class="dv">2</span>,], <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>), <span class="dt">main =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb195-2" data-line-number="2"><span class="kw">qqline</span>(clt[<span class="dv">2</span>,])</a></code></pre></div>
<p><img src="07-boot_files/figure-html/multScalar-2.png" width="672" /></p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb196-1" data-line-number="1"><span class="kw">qqnorm</span>(clt[<span class="dv">3</span>,], <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>), <span class="dt">main =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb196-2" data-line-number="2"><span class="kw">qqline</span>(clt[<span class="dv">3</span>,])</a></code></pre></div>
<p><img src="07-boot_files/figure-html/multScalar-3.png" width="672" /></p>
<p>Now we look at the conditional version where the observed data are conditioned on.</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb197-1" data-line-number="1">## Conditional multiplier CLT</a>
<a class="sourceLine" id="cb197-2" data-line-number="2">x &lt;-<span class="st"> </span><span class="kw">rexp</span>(n) ## given one sample</a>
<a class="sourceLine" id="cb197-3" data-line-number="3">cclt1rep &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb197-4" data-line-number="4">  n &lt;-<span class="st"> </span><span class="kw">length</span>(x)</a>
<a class="sourceLine" id="cb197-5" data-line-number="5">  z2 &lt;-<span class="st"> </span><span class="kw">sum</span>((x <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span><span class="kw">rnorm</span>(n)) <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(n)</a>
<a class="sourceLine" id="cb197-6" data-line-number="6">  z3 &lt;-<span class="st"> </span><span class="kw">sum</span>((x <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span><span class="kw">ifelse</span>(<span class="kw">runif</span>(n) <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">-1</span>)) <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(n)</a>
<a class="sourceLine" id="cb197-7" data-line-number="7">  <span class="kw">c</span>(z2, z3)</a>
<a class="sourceLine" id="cb197-8" data-line-number="8">}</a>
<a class="sourceLine" id="cb197-9" data-line-number="9"></a>
<a class="sourceLine" id="cb197-10" data-line-number="10">cclt &lt;-<span class="st"> </span><span class="kw">replicate</span>(nrep, <span class="kw">cclt1rep</span>(x))</a>
<a class="sourceLine" id="cb197-11" data-line-number="11">## par(mfrow=c(1, 2), mar=c(2.5, 2.5, 0.1, 0.1), mgp=c(1.5, 0.5, 0))</a>
<a class="sourceLine" id="cb197-12" data-line-number="12"><span class="kw">qqnorm</span>(cclt[<span class="dv">1</span>,], <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>), <span class="dt">main =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb197-13" data-line-number="13"><span class="kw">qqline</span>(cclt[<span class="dv">1</span>,])</a></code></pre></div>
<p><img src="07-boot_files/figure-html/cmult-1.png" width="672" /></p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb198-1" data-line-number="1"><span class="kw">qqnorm</span>(cclt[<span class="dv">2</span>,], <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>), <span class="dt">main =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb198-2" data-line-number="2"><span class="kw">qqline</span>(cclt[<span class="dv">2</span>,])</a></code></pre></div>
<p><img src="07-boot_files/figure-html/cmult-2.png" width="672" /></p>
<p>The process version retains the dependence structure which saves much computing time in many applications such as goodness-of-fit tests.</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb199-1" data-line-number="1">uu &lt;-<span class="st"> </span>(<span class="dv">1</span><span class="op">:</span>(<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>n) <span class="op">+</span><span class="st"> </span><span class="fl">0.5</span>) <span class="op">/</span><span class="st"> </span>(<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>n <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb199-2" data-line-number="2">tt &lt;-<span class="st"> </span><span class="kw">qexp</span>(uu)</a>
<a class="sourceLine" id="cb199-3" data-line-number="3"></a>
<a class="sourceLine" id="cb199-4" data-line-number="4">## sampling from the distribution of the KS statistic</a>
<a class="sourceLine" id="cb199-5" data-line-number="5">ks1rep &lt;-<span class="st"> </span><span class="cf">function</span>(n, tt) {</a>
<a class="sourceLine" id="cb199-6" data-line-number="6">  x &lt;-<span class="st"> </span><span class="kw">rexp</span>(n)</a>
<a class="sourceLine" id="cb199-7" data-line-number="7">  ## rate &lt;- 1 / mean(x)</a>
<a class="sourceLine" id="cb199-8" data-line-number="8">  ## using the true rate parameter in pexp</a>
<a class="sourceLine" id="cb199-9" data-line-number="9">  ## if estimate is used, it will be a different distribution</a>
<a class="sourceLine" id="cb199-10" data-line-number="10">  indXt &lt;-<span class="st"> </span><span class="kw">sapply</span>(tt, <span class="cf">function</span>(t) <span class="kw">ifelse</span>(x <span class="op">&lt;=</span><span class="st"> </span>t, <span class="dv">1</span>, <span class="dv">0</span>))</a>
<a class="sourceLine" id="cb199-11" data-line-number="11">  Ft &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">pexp</span>(tt), n, <span class="kw">length</span>(tt), <span class="dt">byrow =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb199-12" data-line-number="12">  z1 &lt;-<span class="st"> </span><span class="kw">colSums</span>(indXt <span class="op">-</span><span class="st"> </span>Ft) <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(n)</a>
<a class="sourceLine" id="cb199-13" data-line-number="13">  ## z1 &lt;- sqrt(n) * (ecdf(x)(tt) - pexp(tt)) ## equivalent but less visual</a>
<a class="sourceLine" id="cb199-14" data-line-number="14">  z2 &lt;-<span class="st"> </span><span class="kw">colSums</span>( <span class="kw">rnorm</span>(n) <span class="op">*</span><span class="st"> </span>(indXt <span class="op">-</span><span class="st"> </span>Ft) ) <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(n)</a>
<a class="sourceLine" id="cb199-15" data-line-number="15">  <span class="kw">c</span>(<span class="kw">max</span>(<span class="kw">abs</span>(z1)), <span class="kw">max</span>(<span class="kw">abs</span>(z2)))</a>
<a class="sourceLine" id="cb199-16" data-line-number="16">}</a>
<a class="sourceLine" id="cb199-17" data-line-number="17"></a>
<a class="sourceLine" id="cb199-18" data-line-number="18"><span class="kw">system.time</span>(ksSamp &lt;-<span class="st"> </span><span class="kw">replicate</span>(nrep, <span class="kw">ks1rep</span>(n, tt)))</a></code></pre></div>
<pre><code>##    user  system elapsed 
##   2.303   0.000   2.303</code></pre>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb201-1" data-line-number="1">ks1cclt &lt;-<span class="st"> </span><span class="cf">function</span>(x, tt) {</a>
<a class="sourceLine" id="cb201-2" data-line-number="2">  n &lt;-<span class="st"> </span><span class="kw">length</span>(x)</a>
<a class="sourceLine" id="cb201-3" data-line-number="3">  indXt &lt;-<span class="st"> </span><span class="kw">sapply</span>(tt, <span class="cf">function</span>(t) <span class="kw">ifelse</span>(x <span class="op">&lt;=</span><span class="st"> </span>t, <span class="dv">1</span>, <span class="dv">0</span>))</a>
<a class="sourceLine" id="cb201-4" data-line-number="4">  Ft &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">pexp</span>(tt), n, <span class="kw">length</span>(tt), <span class="dt">byrow =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb201-5" data-line-number="5">  z &lt;-<span class="st"> </span><span class="kw">colSums</span>( <span class="kw">rnorm</span>(n) <span class="op">*</span><span class="st"> </span>(indXt <span class="op">-</span><span class="st"> </span>Ft) ) <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(n)</a>
<a class="sourceLine" id="cb201-6" data-line-number="6">  <span class="kw">max</span>(<span class="kw">abs</span>(z))</a>
<a class="sourceLine" id="cb201-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb201-8" data-line-number="8"></a>
<a class="sourceLine" id="cb201-9" data-line-number="9"><span class="kw">system.time</span>(ksMult &lt;-<span class="st"> </span><span class="kw">replicate</span>(nrep, <span class="kw">ks1cclt</span>(x, tt)))</a></code></pre></div>
<pre><code>##    user  system elapsed 
##   2.101   0.000   2.101</code></pre>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb203-1" data-line-number="1">ran &lt;-<span class="st"> </span><span class="kw">range</span>(<span class="kw">c</span>(ksSamp, ksMult))</a>
<a class="sourceLine" id="cb203-2" data-line-number="2"><span class="kw">qqplot</span>(ksSamp[<span class="dv">1</span>,], ksSamp[<span class="dv">2</span>,], <span class="dt">main =</span> <span class="st">&quot;&quot;</span>, <span class="dt">xlim =</span> ran, <span class="dt">ylim =</span> ran,</a>
<a class="sourceLine" id="cb203-3" data-line-number="3">       <span class="dt">xlab =</span> <span class="st">&quot;parametric bootstrap&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;multiplier bootstrap&quot;</span>)</a>
<a class="sourceLine" id="cb203-4" data-line-number="4"><span class="kw">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>)</a></code></pre></div>
<p><img src="07-boot_files/figure-html/multProc-1.png" width="672" /></p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb204-1" data-line-number="1"><span class="kw">qqplot</span>(ksSamp[<span class="dv">1</span>,], ksMult, <span class="dt">main =</span> <span class="st">&quot;&quot;</span>, <span class="dt">xlim =</span> ran, <span class="dt">ylim =</span> ran,</a>
<a class="sourceLine" id="cb204-2" data-line-number="2">       <span class="dt">xlab =</span> <span class="st">&quot;parametric bootstrap&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;conditional multipler bootstrap&quot;</span>)</a>
<a class="sourceLine" id="cb204-3" data-line-number="3"><span class="kw">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>)</a></code></pre></div>
<p><img src="07-boot_files/figure-html/multProc-2.png" width="672" /></p>
<p>Application of the multiplier CLT needs the asymptotic representation of the random quantities or process of interest.</p>
<p>Question: for goodness-of-fit tests with unknown parameters, how would the procedure of the conditional multiplier approach change? This is the subject of <span class="citation">Kojadinovic and Yan (<a href="#ref-Koja:Yan:good:2012">2012</a>)</span>.</p>
</div>
</div>
<div id="exercises-6" class="section level2">
<h2><span class="header-section-number">8.6</span> Exercises</h2>
<ol style="list-style-type: decimal">
<li><p>Suppose that <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> are independent
<span class="math inline">\(\Gamma(\alpha_1, \beta_1)\)</span> and <span class="math inline">\(\Gamma(\alpha_2, \beta_2)\)</span>
variables, where
<span class="math inline">\(\Gamma(a, b)\)</span> have mean <span class="math inline">\(a b\)</span>. We are interested in point and
interval estimation of <span class="math inline">\(\theta = \mathbb{E}(X) / \mathbb{E}(Y)\)</span> based on two
independent samples of size <span class="math inline">\(n_1\)</span> and <span class="math inline">\(n_2\)</span>, respectively. Consider
for example <span class="math inline">\(\alpha_1 = \beta_1 = 2\)</span>, <span class="math inline">\(\alpha_2 = 4\)</span>, <span class="math inline">\(\beta = 2\)</span>,
<span class="math inline">\(n_1 = 10\)</span> and <span class="math inline">\(n_2 = 15\)</span>. Set the random seed to be 123 for
reproducibility. Let <span class="math inline">\(\bar X\)</span> and <span class="math inline">\(\bar Y\)</span> be the sample
means. Consider statistic <span class="math inline">\(T = \bar X / \bar Y\)</span>.</p>
<ol style="list-style-type: lower-alpha">
<li>Given the sample, draw bootstrap samples of <span class="math inline">\(T\)</span> using the
nonparametric method and the parametric method with sample size
<span class="math inline">\(B = 1000\)</span>.</li>
<li>Correct the bias of <span class="math inline">\(T\)</span> in estimating <span class="math inline">\(\theta\)</span>.</li>
<li>Construct a 95% bootstrap percentile confidence interval for <span class="math inline">\(\theta\)</span>.</li>
<li>Repeat the experiments 1000 times. Compare the average bias
with the exact bias; compare the empirical coverage of the 95%
bootstrap confidence interval with the nominal level.</li>
</ol></li>
<li><p>One goodness-of-fit diagnosis is the QQ plot. Consider a random
sample of size <span class="math inline">\(n\)</span> from <span class="math inline">\(N(\mu, \sigma^2)\)</span>. A QQ plot displays the
empirical quantiles against the theoretical quannntiles. For
uncertainty assessment, a pointwise confidence interval constructed
from simulation is often overlaid . In practice, the parameters of
the distribution to be checked are unknown and the estimation
uncertainty needs to be take into account. Let <span class="math inline">\(n = 10\)</span>, <span class="math inline">\(\mu = 0\)</span>,
and <span class="math inline">\(\sigma^2 = 1\)</span>.</p>
<ol style="list-style-type: lower-alpha">
<li>Construct a QQ plot with pointwise confidence intervals with
known <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\sigma^2\)</span>.</li>
<li>Construct a QQ plot with pointwise confidence intervals with
estimated <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\sigma^2\)</span>. The uncertainty in estimated
parameters can be realized by bootstrapping.</li>
<li>Repeat with sample size <span class="math inline">\(n \in \{20, 30\}\)</span>.</li>
</ol></li>
</ol>

</div>
</div>



<h3>References</h3>
<div id="refs" class="references">
<div id="ref-chernoff1954use">
<p>Chernoff, Herman, and EL Lehmann. 1954. “The Use of Maximum Likelihood Estimates in <span class="math inline">\(\chi\)</span>2 Tests for Goodness of Fit.” <em>The Annals of Mathematical Statistics</em>. JSTOR, 579–86.</p>
</div>
<div id="ref-Davi:Hink:boot:1997">
<p>Davison, Anthony Christopher. 1997. <em>Bootstrap Methods and Their Application</em>. Cambridge University Press.</p>
</div>
<div id="ref-Heff:Tawn:cond:2004">
<p>Heffernan, Janet E, and Jonathan A Tawn. 2004. “A Conditional Approach for Multivariate Extreme Values (with Discussion).” <em>Journal of the Royal Statistical Society: Series B (Statistical Methodology)</em> 66 (3). Wiley Online Library: 497–546.</p>
</div>
<div id="ref-Koja:Yan:good:2012">
<p>Kojadinovic, Ivan, and Jun Yan. 2012. “Goodness-of-Fit Testing Based on a Weighted Bootstrap: A Fast Large-Sample Alternative to the Parametric Bootstrap.” <em>Canadian Journal of Statistics</em> 40 (3): 480–500. <a href="https://doi.org/10.1002/cjs.11135" class="uri">https://doi.org/10.1002/cjs.11135</a>.</p>
</div>
<div id="ref-van:Well:weak:1996">
<p>Van Der Vaart, Aad W, and Jon A Wellner. 1996. <em>Weak Convergence</em>. Springer.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="mcinteg.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="git-setup.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
